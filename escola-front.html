<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento Escolar - Cursos e Matr√≠cula</title>
    <style>
        /* ESTILOS DA NAVBAR */
        .navbar {
            background-color: #333;
            padding: 10px 20px;
            margin-bottom: 25px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            color: white;
            font-size: 1.5em;
            text-decoration: none;
            font-weight: bold;
        }

        .navbar-links a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            margin-left: 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .navbar-links a:hover {
            background-color: #555;
        }

        /* ESTILOS PRINCIPAIS */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f9;
        }

        .container {
            display: flex;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .panel {
            flex: 1;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1,
        h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }

        form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        form input[type="text"],
        form input[type="email"],
        form select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        form button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        form button:hover {
            background-color: #218838;
        }

        #courses-list {
            list-style: none;
            padding: 0;
        }

        .course-item {
            border: 1px solid #eee;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 4px;
            background-color: #fafafa;
        }

        .course-item strong {
            color: #007bff;
        }

        #message,
        #status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>

<body>
    <div class="navbar">
        <a href="escola-front.html" class="navbar-brand">üè´ Escola App</a>
        <div class="navbar-links">
            <a href="escola-front.html">Matr√≠culas</a>
            <a href="employee.html">üîë √Årea do Funcion√°rio</a> 
        </div>
    </div>
    <h1>Gest√£o de Cursos e Matr√≠culas</h1>
    <div class="container">

        <div class="panel">
            <h2>üìù Matricular Novo Aluno</h2>
            <form id="enrollmentForm">
                <label for="studentname">Nome:</label>
                <input type="text" id="studentname" required>

                <label for="studentemail">Email:</label>
                <input type="email" id="studentemail" required>

                <label for="studentCpf">CPF:</label>
                <input type="text" id="studentCpf" required>

                <label for="phone">Telefone:</label>
                <input type="text" id="phone" required>

                <label for="birthdate">Data Nasc. (DD/MM/AAAA):</label>
                <input type="text" id="birthdate" required>

                <label for="courseId">ID do Curso (Ver Lista ao Lado):</label>
                <input type="text" id="courseId" placeholder="Ex: 1, 2, 3" required>

                <button type="submit">Realizar Matr√≠cula</button>
            </form>
            <div id="message"></div>
        </div>

        <div class="panel">
            <h2>üìö Cursos Dispon√≠veis</h2>
            <button onclick="fetchCourses()">Recarregar Cursos</button>
            <div id="status-message"></div>
            <ul id="courses-list">
                <li>Clique em "Recarregar Cursos" para buscar dados do NestJS.</li>
            </ul>
        </div>
    </div>

    <script>
        
        const BASE_URL = 'http://localhost:3000';
        const API_COURSES = `${BASE_URL}/courses`;
        const API_ENROLLMENTS = `${BASE_URL}/enrollments`;

        
        async function fetchCourses() {
            const statusDiv = document.getElementById('status-message');
            const listUl = document.getElementById('courses-list');
            statusDiv.textContent = 'Carregando cursos...';
            listUl.innerHTML = '';

            try {
                const response = await fetch(API_COURSES);

                if (!response.ok) {
                    throw new Error(`Erro HTTP! Status: ${response.status}`);
                }

                const courses = await response.json();

                statusDiv.textContent = `Cursos carregados com sucesso (${courses.length} encontrados).`;
                statusDiv.className = 'success';

                if (courses.length === 0) {
                    listUl.innerHTML = '<li>Nenhum curso encontrado.</li>';
                    return;
                }

                courses.forEach(course => {
                    const item = document.createElement('li');
                    item.className = 'course-item';
                    item.innerHTML = `
                        <strong>ID:</strong> ${course.id} <br>
                        <strong>Curso:</strong> ${course.course} <br>
                        <strong>Valor:</strong> R$ ${course.value ? course.value.toFixed(2) : 'N/A'} <br>
                        Descri√ß√£o: ${course.description}
                    `;
                    listUl.appendChild(item);
                });

            } catch (error) {
                statusDiv.textContent = `Erro ao buscar cursos: ${error.message}. Verifique o NestJS.`;
                statusDiv.className = 'error';
                console.error('Erro de Fetch Cursos:', error);
            }
        }

      
        document.getElementById('enrollmentForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const messageDiv = document.getElementById('message');
            messageDiv.className = '';
            messageDiv.textContent = 'Enviando dados de matr√≠cula...';

            const courseIdValue = document.getElementById('courseId').value;
            const parsedCourseId = parseInt(courseIdValue);

            if (isNaN(parsedCourseId) || !courseIdValue) {
                messageDiv.className = 'error';
                messageDiv.textContent = 'Erro: O ID do Curso deve ser um n√∫mero v√°lido.';
                return;
            }


            const enrollmentData = {
                studentname: document.getElementById('studentname').value,
                studentemail: document.getElementById('studentemail').value,
                studentCpf: document.getElementById('studentCpf').value,
                phone: document.getElementById('phone').value,
                birthdate: document.getElementById('birthdate').value,
                
                courseId: parsedCourseId 
            };
            
            enrollmentData.createdAt = new Date().toISOString();

            try {
                const response = await fetch(API_ENROLLMENTS, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(enrollmentData)
                });

                const result = await response.json();

                if (response.ok) {
                    messageDiv.className = 'success';
                    
                  
                    const returnedId = result.id || 'N/A (Verifique o Service no NestJS)';
                    
                    messageDiv.textContent = `Matr√≠cula realizada com sucesso! Aluno: ${result.studentname || enrollmentData.studentname}. ID: ${returnedId}`;
                    document.getElementById('enrollmentForm').reset();
                } else {
                    messageDiv.className = 'error';

                    const errorMessage = result.message ? (Array.isArray(result.message) ? result.message.join(', ') : result.message) : 'Erro desconhecido.';
                    messageDiv.textContent = `Falha na Matr√≠cula: ${errorMessage}`;
                }

            } catch (error) {
                messageDiv.className = 'error';
                messageDiv.textContent = `Erro de conex√£o: N√£o foi poss√≠vel alcan√ßar o servidor NestJS.`;
                console.error('Erro de Fetch Matr√≠cula:', error);
            }
        });
         
        fetchCourses();
    </script>

</body>

</html>